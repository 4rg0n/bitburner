import { Terminal } from '/lib/Terminal';
import { Flags } from '/lib/Flags';
import { Zerver } from '/server/Zerver';
import { Cracker } from '/dist/Cracker';
export async function main(ns) {
    const flags = new Flags(ns, [
        ["target", "faction", `target or deamon; will try to backdoor all, when no target`],
        ["sleep", 5, `in seconds`],
        ["help", false, "For installing backdoors on servers"]
    ]);
    const args = flags.args();
    const target = args["target"];
    const sleep = args["sleep"];
    const terminal = new Terminal();
    const cracker = new Cracker(ns);
    let servers;
    if (target === "deamon") {
        servers = Zerver.get(ns).filter(z => z.type === Zerver.ServerType.Target);
    }
    else if (target === "faction") {
        servers = Zerver.get(ns).filter(z => z.type === Zerver.ServerType.Faction);
    }
    else {
        servers = Zerver.get(ns).filter(z => !z.isHome || !z.isOwn);
    }
    // sort by lowest level first
    servers = servers.sort((a, b) => a.levelNeeded - b.levelNeeded);
    for (const server of servers) {
        cracker.crackServer(server);
        if (server.hasRoot && server.isHackable) {
            terminal.connect(server.path);
            terminal.cmd("backdoor");
            await ns.sleep(sleep * 1000);
            ns.toast(`Installed backdoor at ${server.name}`, "success");
        }
        else {
            ns.toast(`Backdoor installation failed ${server.name}`, "warning");
        }
    }
    // go back home
    terminal.cmdHome("");
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2Rvb3IuanMiLCJzb3VyY2VSb290IjoiaHR0cDovL2xvY2FsaG9zdDo4MDAwL3NvdXJjZXMvIiwic291cmNlcyI6WyJiYWNrZG9vci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFBO0FBQ3hDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDbkMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFeEMsTUFBTSxDQUFDLEtBQUssVUFBVSxJQUFJLENBQUMsRUFBTztJQUM5QixNQUFNLEtBQUssR0FBRyxJQUFJLEtBQUssQ0FBQyxFQUFFLEVBQUU7UUFDeEIsQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLDREQUE0RCxDQUFDO1FBQ25GLENBQUMsT0FBTyxFQUFFLENBQUMsRUFBRSxZQUFZLENBQUM7UUFDMUIsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLHFDQUFxQyxDQUFDO0tBQ3pELENBQUMsQ0FBQztJQUVILE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMxQixNQUFNLE1BQU0sR0FBWSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDdkMsTUFBTSxLQUFLLEdBQVksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3JDLE1BQU0sUUFBUSxHQUFHLElBQUksUUFBUSxFQUFFLENBQUM7SUFDaEMsTUFBTSxPQUFPLEdBQUcsSUFBSSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7SUFFaEMsSUFBSSxPQUFPLENBQUM7SUFFWixJQUFJLE1BQU0sS0FBSyxRQUFRLEVBQUU7UUFDckIsT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQzdFO1NBQU0sSUFBSSxNQUFNLEtBQUssU0FBUyxFQUFFO1FBQzdCLE9BQU8sR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssTUFBTSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQztLQUM5RTtTQUFNO1FBQ0gsT0FBTyxHQUFHLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0tBQy9EO0lBRUQsNkJBQTZCO0lBQzdCLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUM7SUFFaEUsS0FBSyxNQUFNLE1BQU0sSUFBSSxPQUFPLEVBQUU7UUFDMUIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUU1QixJQUFJLE1BQU0sQ0FBQyxPQUFPLElBQUksTUFBTSxDQUFDLFVBQVUsRUFBRTtZQUNyQyxRQUFRLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5QixRQUFRLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3pCLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLENBQUM7WUFDN0IsRUFBRSxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1NBQy9EO2FBQU07WUFDSCxFQUFFLENBQUMsS0FBSyxDQUFDLGdDQUFnQyxNQUFNLENBQUMsSUFBSSxFQUFFLEVBQUUsU0FBUyxDQUFDLENBQUM7U0FDdEU7S0FDSjtJQUVELGVBQWU7SUFDZixRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3pCLENBQUMifQ==